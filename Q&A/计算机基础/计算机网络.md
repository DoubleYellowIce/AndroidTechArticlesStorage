### 传输层

#### TCP

##### 三次握手

<div align="center"> <img src="https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/e92d0ebc-7d46-413b-aec1-34a39602f787.png" width="600"/> </div><br>

- 关键字段

  - Seq。该字段为序列号。
  - SYN。该字段为同步字段，只会在第一，第二次握手时为1。
  - ACK。该字段为确认字段，根据规范，在建立连接后此字段都应该为1。
  - ack。该字段的作用是表明期待收到的序列号，从而告知另一端ack前面的序列都已经成功收到了。

- 三次握手可以改为两次握手吗？为什么？

  不可以，三次握手的目的是为了避免无效的连接请求到达服务器建立重复的连接。

  假设当客户端第一次给服务端发送连接请求报文，遇上了网络阻塞，该报文迟迟未能到达服务端，客户端在等待一定时长后，会选择重新发送连接请求报文，第二次发送的连接请求报文顺利到达服务端且顺利建立连接，此时第一次的连接请求报文也到达了服务端，服务端会给客户端发送连接请求的确认报文，在这种情况下

  - 如果只有两次握手，那么就会重复建立TCP连接。
  - 如果有三次握手，客户端会知道这是对失效连接请求报文的确认，可直接丢弃。

##### 四次挥手

<div align="center"> <img src="https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/f87afe72-c2df-4c12-ac03-9b8d581a8af8.jpg" width="600"/> </div><br>

- 关键字段

  - FIN。该字段的作用是告诉另一端要释放TCP连接了。

- 四次挥手的原因？

  为了让服务端发送完还未发送的报文。

- 为什么客户端TIME-WAIT阶段需要等待2MSL？

  等待的原因有两点

  - 防止服务端没有收到客户端的确认报文，又重新发送连接释放报文。
  - 让此次连接的报文都从网络中消失，确保下一次的连接不会出现此次连接的报文。

- 2MSL又是什么？为什么是2MSL，不是1MSL，3MSL，100MSL？

  MSL全称为**Maximium Segment Lifetime**，是一个报文在网络中的最长存活时间，2MSL是报文来回所需要的最长时间，在2MSL中如果没有重新收到服务端的连接释放报文，就可以确认第四次挥手所发送的确认报文没有丢失。

### 应用层

#### DNS

- DNS是基于什么传输层协议上的，为什么？

  DNS是基于Udp的，原因有如下三点

  - DNS响应报文通常比较小，即使在传输过程发生丢失，重传的代价也是可以接受的。
  - 尽管Tcp是可靠传输，但由于三次握手，四次挥手的建立连接或释放连接过程的存在，有一定的延迟。

  - Tcp需要建立连接，一个DNS服务器往往是服务一大片区域的，我国属于是面积辽阔，网民众多的国家，根域名服务器也只有26台，如果DNS采用Tcp，维护这么多连接，这对DNS服务器的压力是难以想象。

- Udp是不可靠传输，那么DNS是一个不可靠的应用层协议吗？

  不是的，DNS在应用层实现了超时重传的可靠传输。

- DNS只使用Udp吗？

  不是的，在下列两种情况，DNS会使用Tcp。

  - 响应报文超过512字节。这是因为Udp响应报文最大为512字节。
  - 区域传送。区域传送会在主域名服务器给辅助域名服务器传送变化的部分。

#### FTP

FTP有两个连接，控制连接和数据连接。

- 控制连接

  服务端开放端口号21，由客户端主动建立连接，客户端利用这个连接发送命令给服务端，并接收服务端的响应。

- 数据连接

  数据连接是用于数据传送，根据服务端是否主动建立连接分为主动模式和被动模式。

  - 主动模式。

    服务端端口号为20，客户端端口号任意，但必须大于等于1024，因为0～1023为熟知端口号。

    该模式的缺点是客户端必须开发端口号给服务端，需要配置防火墙。

  - 被动模式。

    客户端指定任意端口号，服务端端口号任意。

    该模式的缺点是服务端会暴露太多的端口号，有一定的安全隐患。

### 参考资料

1. [计算机网络](https://github.com/CyC2018/CS-Notes/blob/master/notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%20-%20%E7%9B%AE%E5%BD%95.md)
2. [根域名服务器只有13台？](https://zhuanlan.zhihu.com/p/107492241)
2. [What is a Firewall?](https://www.youtube.com/watch?v=kDEX1HXybrU&ab_channel=PowerCertAnimatedVideos)

